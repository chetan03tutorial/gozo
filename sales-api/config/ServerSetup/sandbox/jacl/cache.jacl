source ./proc.jacl

#--------------------------------------------------------------
# Adds Caches to the Node's default Cache provider
# Author: Jesper Madsen
#--------------------------------------------------------------

#--------------------------------------------------------------
# Add CACHE PROC
#--------------------------------------------------------------
proc addCaches {cachesList} {
    #--------------------------------------------------------------
    # set up globals
    #--------------------------------------------------------------
    global AdminConfig defCP props

    # loop the cache list
    foreach cache $cachesList {
        puts "Info: Adding cache from data: $cache"
        
        if { [llength $cache] != 3 } {
            error "Error: -- cache data does not consist of 3 items"
        }

        # set props for the cache
        set cacheName [lindex $cache 0]
        set cacheJndiName [lindex $cache 1]     
        set desc [lindex $cache 2]

        set cacheAttrs [list [list name $cacheName] [list jndiName $cacheJndiName] [list description $desc]]

        set cacheId [$AdminConfig getid "/ObjectCacheInstance:$cacheName/"]

        puts "CacheId is: $cacheId"

        # If it exists already then modify it
        if { [string length $cacheId] > 0 } {
            set res [$AdminConfig modify $cacheId $cacheAttrs]
            if { [string length $res] > 0 } {
                error "Error: -- unable to modify ObjectCacheInstance '$cacheName' - $res"
            } else {
                puts "Info: Successfully modified existing ObjectCacheInstance '$cacheName'."
            }
        }

        # If it doesn't exist then create it
        if { [string length $cacheId] == 0 } {
            set res [$AdminConfig create ObjectCacheInstance $defCP $cacheAttrs]
            if { [string length $res] == 0 } {
                error "Error: -- unable to create ObjectCacheInstance '$cacheName'."
            } else {
                puts "Info: Successfully created ObjectCacheInstance '$res'."
            }       
        }   
    }
}

#--------------------------------------------------------------
# Main
#--------------------------------------------------------------


# Load input.props file
set propFile input.props
set props   [loadProperties $propFile]

set nodeName    [$props getProperty was.node.name]
set srvName     [$props getProperty srv.name]

puts "Info: Node name: $nodeName"

if { [string length $nodeName] == 0 } {
    error "Error: -- no node name defined."
}

set defCP [$AdminConfig getid "/Node:$nodeName/CacheProvider:/"]

puts "Info: Def cache provider for node is: $defCP"


#--------------------------------------------------------------
# Add Caches to create to this section:
#
# The format for the cache is space delimited as below:
# set CPn {"name" "jndiName" "desc"}
#
# sample:
#
# set CP1 {"MyCacheName" "/cache/myCache" "The description of the cache"}
#
# also remember to add it to the caches list.
#--------------------------------------------------------------

# WS Endpoint Caches

##-------------------SHARED ACCROSS ALL CHANNELS------------------####
set CP1 {"UIConfigCache" "/services/cache/ui_config" "Object Cache for configuration data"}

##-------------------LTSBRetail------------------####
set CP2 {"AppCacheLTSBRetail_products" "/services/cache/appdataLTSBRetail_products" "Object Cache for application data"}
set CP3 {"UIContentBundleCacheLTSBRetail_products" "/services/cache/ui_cms_bundlesLTSBRetail_products" "Object Cache for CMS resource bundle data"}
set CP4 {"UIContentResourcesCacheLTSBRetail_products" "/services/cache/ui_resourcesLTSBRetail_products" "Object Cache for resources data"}
set CP5 {"UIContentTextCacheLTSBRetail_products" "/services/cache/ui_cms_textLTSBRetail_products" "Object Cache for CMS content data"}
set CP6 {"UIRefdataCacheLTSBRetail_products" "/services/cache/refdataLTSBRetail_products" "Object Cache for IBL channel reference data"}

##-------------------LTSBCommercial------------------####
set CP7 {"AppCacheLTSBCommercial_products" "/services/cache/appdataLTSBCommercial_products" "Object Cache for application data"}
set CP8 {"UIContentBundleCacheLTSBCommercial_products" "/services/cache/ui_cms_bundlesLTSBCommercial_products" "Object Cache for CMS resource bundle data"}
set CP9 {"UIContentResourcesCacheLTSBCommercial_products" "/services/cache/ui_resourcesLTSBCommercial_products" "Object Cache for resources data"}
set CP10 {"UIContentTextCacheLTSBCommercial_products" "/services/cache/ui_cms_textLTSBCommercial_products" "Object Cache for CMS content data"}
set CP11 {"UIRefdataCacheLTSBCommercial_products" "/services/cache/refdataLTSBCommercial_products" "Object Cache for IBL channel reference data"}

##-------------------BOSCommercial------------------####
set CP12 {"AppCacheBOSCommercial_products" "/services/cache/appdataBOSCommercial_products" "Object Cache for application data"}
set CP13 {"UIContentBundleCacheBOSCommercial_products" "/services/cache/ui_cms_bundlesBOSCommercial_products" "Object Cache for CMS resource bundle data"}
set CP14 {"UIContentResourcesCacheBOSCommercial_products" "/services/cache/ui_resourcesBOSCommercial_products" "Object Cache for resources data"}
set CP15 {"UIContentTextCacheBOSCommercial_products" "/services/cache/ui_cms_textBOSCommercial_products" "Object Cache for CMS content data"}
set CP16 {"UIRefdataCacheBOSCommercial_products" "/services/cache/refdataBOSCommercial_products" "Object Cache for IBL channel reference data"}

##-------------------BOSRetail------------------####
set CP17 {"AppCacheBOSRetail_products" "/services/cache/appdataBOSRetail_products" "Object Cache for application data"}
set CP18 {"UIContentBundleCacheBOSRetail_products" "/services/cache/ui_cms_bundlesBOSRetail_products" "Object Cache for CMS resource bundle data"}
set CP19 {"UIContentResourcesCacheBOSRetail_products" "/services/cache/ui_resourcesBOSRetail_products" "Object Cache for resources data"}
set CP20 {"UIContentTextCacheBOSRetail_products" "/services/cache/ui_cms_textBOSRetail_products" "Object Cache for CMS content data"}
set CP21 {"UIRefdataCacheBOSRetail_products" "/services/cache/refdataBOSRetail_products" "Object Cache for IBL channel reference data"}

##-------------------HalifaxRetail------------------####
set CP22 {"AppCacheHalifaxRetail_products" "/services/cache/appdataHalifaxRetail_products" "Object Cache for application data"}
set CP23 {"UIContentBundleCacheHalifaxRetail_products" "/services/cache/ui_cms_bundlesHalifaxRetail_products" "Object Cache for CMS resource bundle data"}
set CP24 {"UIContentResourcesCacheHalifaxRetail_products" "/services/cache/ui_resourcesHalifaxRetail_products" "Object Cache for resources data"}
set CP25 {"UIContentTextCacheHalifaxRetail_products" "/services/cache/ui_cms_textHalifaxRetail_products" "Object Cache for CMS content data"}
set CP26 {"UIRefdataCacheHalifaxRetail_products" "/services/cache/refdataHalifaxRetail_products" "Object Cache for IBL channel reference data"}

##-------------------COMMON------------------####
set CP27 {"AppCache_products" "/services/cache/appdata_products" "Object Cache for application data"}
set CP28 {"UIContentBundleCache_products" "/services/cache/ui_cms_bundles_products" "Object Cache for CMS resource bundle data"}
set CP29 {"UIContentResourcesCache_products" "/services/cache/ui_resources_products" "Object Cache for resources data"}
set CP30 {"UIContentTextCache_products" "/services/cache/ui_cms_text_products" "Object Cache for CMS content data"}
set CP31 {"UIRefdataCache_products" "/services/cache/refdata_products" "Object Cache for IBL channel reference data"}

##-------------------VerdeRetail------------------####
set CP32 {"AppCacheVerdeRetail_products" "/services/cache/appdataVerdeRetail_products" "Object Cache for application data"}
set CP33 {"UIContentBundleCacheVerdeRetail_products" "/services/cache/ui_cms_bundlesVerdeRetail_products" "Object Cache for CMS resource bundle data"}
set CP34 {"UIContentResourcesCacheVerdeRetail_products" "/services/cache/ui_resourcesVerdeRetail_products" "Object Cache for resources data"}
set CP35 {"UIContentTextCacheVerdeRetail_products" "/services/cache/ui_cms_textVerdeRetail_products" "Object Cache for CMS content data"}
set CP36 {"UIRefdataCacheVerdeRetail_products" "/services/cache/refdataVerdeRetail_products" "Object Cache for IBV channel reference data"}

##-------------------VerdeCommercial------------------####
set CP37 {"AppCacheVerdeCommercial_products" "/services/cache/appdataVerdeCommercial_products" "Object Cache for application data"}
set CP38 {"UIContentBundleCacheVerdeCommercial_products" "/services/cache/ui_cms_bundlesVerdeCommercial_products" "Object Cache for CMS resource bundle data"}
set CP39 {"UIContentResourcesCacheVerdeCommercial_products" "/services/cache/ui_resourcesVerdeCommercial_products" "Object Cache for resources data"}
set CP40 {"UIContentTextCacheVerdeCommercial_products" "/services/cache/ui_cms_textVerdeCommercial_products" "Object Cache for CMS content data"}
set CP41 {"UIRefdataCacheVerdeCommercial_products" "/services/cache/refdataVerdeCommercial_products" "Object Cache for STV channel reference data"}


# Add all defined caches above to the list (space delimited) below:
##Adding a dummy cache to make the luis run
set caches [list $CP1 $CP2 $CP3 $CP4 $CP5 $CP6 $CP7 $CP8 $CP9 $CP10 $CP11 $CP12 $CP13 $CP14 $CP15 $CP16 $CP17 $CP18 $CP19 $CP20 $CP21 $CP22 $CP23 $CP24 $CP25 $CP26 $CP27 $CP28 $CP29 $CP30 $CP31 $CP32 $CP33 $CP34 $CP35 $CP36 $CP37 $CP38 $CP39 $CP40 $CP41]

# Call proc to add the caches
addCaches $caches

# Save the changes
$AdminConfig save

